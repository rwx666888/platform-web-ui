<!doctype html>

<html>

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <!-- mainly css -->
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/iconfont.css?v=20171212114242" rel="stylesheet">
        <link href="../css/plugins/dataTables/datatables.min.css" rel="stylesheet">
        <link href="../js/plugins/datatables/Scroller-1.4.2/css/scroller.bootstrap.min.css" rel="stylesheet">

        <link href="../css/style.css?v=20171212114242" id="cus_app_link" rel="stylesheet">

        <title>test-3-2</title>
        <style>
            th {
                min-width: 50px
            }
            .DTFC_LeftBodyWrapper {
                z-index: 9;
            }
            .js-cell-btn{
                font-size: 16px;
                cursor: pointer;
                margin-left: 3px;
            }
            .table > thead > tr > th{
                vertical-align: middle;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <button class="btn btn-default js-cus-btn" data-item="1">区域</button>
                    <button class="btn btn-default js-cus-btn" data-item="2">城市</button>
                    <button class="btn btn-default js-cus-btn" data-item="3">中心</button>
                </div>
            </div>
            <div class="row form-horizontal m-b-sm m-t-sm">
                <div class="col-sm-12">

                    <table id="ddd" class="table table-striped table-bordered" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th rowspan="3">
                                    序号
                                </th>
                                <th rowspan="3">
                                    区域
                                </th>
                                <th rowspan="3">
                                    城市
                                </th>
                                <th rowspan="3">
                                    中心
                                </th>
                                <th rowspan="3">
                                    开业日期
                                </th>
                                <th colspan="11">
                                    全款缴费量
                                </th>
                                <th colspan="12">
                                    各渠道缴费人数占比 <i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="21,22,23,24,25,26,27"></i>
                                </th>
                                <th colspan="72">
                                    各渠道转化率
                                </th>
                                <th colspan="2">
                                    开班全款收入（截止日期所在月份1至截止日期）
                                </th>
                            </tr>
                            <tr>
                                <th rowspan="2">
                                    新增
                                </th>
                                <th rowspan="2">
                                    续费
                                </th>
                                <th colspan="8">
                                    收取全款收入
                                </th>
                                <th rowspan="2">
                                    缴费<br/> 完成率
                                </th>
                                <th rowspan="2">
                                    搜索
                                </th>
                                <th rowspan="2">
                                    信息流
                                </th>
                                <th rowspan="2">
                                    地推
                                </th>
                                <th rowspan="2">
                                    中心<br/>外呼
                                </th>
                                <th rowspan="2">
                                    口碑
                                </th>
                                <th rowspan="2" class="qdjfrs-cell">
                                    直访
                                </th>
                                <th rowspan="2" class="qdjfrs-cell">
                                    集团<br/>400
                                </th>
                                <th rowspan="2" class="qdjfrs-cell">
                                    网络营<br/>销其他
                                </th>
                                <th rowspan="2" class="qdjfrs-cell">
                                    渠道<br/>合作
                                </th>
                                <th rowspan="2" class="qdjfrs-cell">
                                    社群<br/>新媒体
                                </th>
                                <th rowspan="2" class="qdjfrs-cell">
                                    品牌
                                </th>
                                <th rowspan="2" class="qdjfrs-cell">
                                    其他
                                </th>
                                <th colspan="6">
                                    搜索（新增量不含续费量）<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="29,30,31"></i>
                                </th>
                                <th colspan="6">
                                    信息流<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="35,36,37"></i>
                                </th>
                                <th colspan="6">
                                    地推<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="ditui-btn"></i>
                                </th>
                                <th colspan="6">
                                    中心外呼<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="zhongxinwh-btn"></i>
                                </th>
                                <th colspan="6">
                                    口碑<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="koubei-btn"></i>
                                </th>
                                <th colspan="6">
                                    直访<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="zhifang-btn"></i>
                                </th>
                                <th colspan="6">
                                    集团400<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="jituan400-btn"></i>
                                </th>
                                <th colspan="6">
                                    网络营销其他<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="wangluoyx-btn"></i>
                                </th>
                                <th colspan="6">
                                    渠道合作<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="qudaohz-btn"></i>
                                </th>
                                <th colspan="6">
                                    社群新媒体<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="shequnxmt-btn"></i>
                                </th>
                                <th colspan="6">
                                    品牌<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="pinpai-btn"></i>
                                </th>
                                <th colspan="6">
                                    其他<i class="js-cell-btn glyphicon glyphicon-plus-sign" data-action="qita-btn"></i>
                                </th>
                                <th rowspan="2">
                                    课耗收入
                                </th>
                                <th rowspan="2">
                                    现金收入
                                </th>
                            </tr>
                            <tr>
                                <th>
                                    人数
                                </th>
                                <th>
                                    现金（元）
                                </th>
                                <th>
                                    贡献占比
                                </th>
                                <th>
                                    环比
                                </th>
                                <th>
                                    同比
                                </th>
                                <th>
                                    童创占比
                                </th>
                                <th>
                                    续费占比
                                </th>
                                <th>
                                    在线收入
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th class="sousuo-cell">
                                    诺到量
                                </th>
                                <th class="sousuo-cell">
                                    实到量
                                </th>
                                <th class="sousuo-cell">
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th class="xxliu-cell">
                                    诺到量
                                </th>
                                <th class="xxliu-cell">
                                    实到量
                                </th>
                                <th class="xxliu-cell">
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th class="ditui-cell">
                                    诺到量
                                </th>
                                <th class="ditui-cell">
                                    实到量
                                </th>
                                <th class="ditui-cell">
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                                <th>
                                    信息量
                                </th>
                                <th>
                                    诺到量
                                </th>
                                <th>
                                    实到量
                                </th>
                                <th>
                                    报名量
                                </th>
                                <th>
                                    缴费量
                                </th>
                                <th>
                                    总转率
                                </th>
                            </tr>
                            <tr>
                                <th>
                                    集团合计
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    3,526
                                </th>
                                <th>
                                    679
                                </th>
                                <th>
                                    4,205
                                </th>
                                <th>
                                    44,273,600
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    151%
                                </th>
                                <th>
                                    38%
                                </th>
                                <th>
                                    15%
                                </th>
                                <th></th>
                                <th>
                                    21%
                                </th>
                                <th>
                                    7%
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    4,660
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    8.0%
                                </th>
                                <th>
                                    1,018
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    46.7%
                                </th>
                                <th></th>
                                <th></th>
                                <th>
                                    3,839
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    1,461
                                </th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>
                                    18,038,076
                                </th>
                                <th>
                                    38,363,742
                                </th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>

                </div>
            </div>
        </div>
        <script src="../js/jquery-2.1.1.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/bootstrap-plugins-custom.js?v=20171212114242"></script>
        <script src="../js/plugins/datatables/datatables.min.js?v=20171212114242"></script>

        <script src="../js/plugins/datatables/Scroller-1.4.2/js/dataTables.scroller.min.js"></script>

        <script src="../i18n/zh-CN.js?v=20171212114242"></script>
        <script src="../js/plugins/layer/layer.js"></script>

        <script src="../js/plugins/validate/jquery.validate.custom.js"></script>

        <script src="../js/plugins/jquery-number/jquery.number.js" type="text/javascript"></script>
        <script type="text/javascript" src="../js/subindex.js" ></script>

        <script type="text/javascript" src="../js/jquery.mockjax.min.js"></script>
        <script type="text/javascript" src="../demo-data.js"></script>

        <script>
            $(function() {
                var aar = [];

                for(var t = 0; t < 102; t++) {
                    aar.push({
                        "data": "node" + t
                    });
                }

                //console.log(aar);

                var dt_ = {};

                var num_ = 20;
                //var targets_ = ['qdjfrs-cell', 'sousuo-cell', 'xxliu-cell', 'ditui-cell', 'zhongxinwh-cell', 'koubei-cell', 'zhifang-cell', '.jituan400-cell', '.wangluoyx-cell', '.qudaohz-cell', '.shequnxmt-cell', '.pinpai-cell', '.qita-cell', '.kehaoshouru-cell', '.xinjinshouru-cell'];
                var default_targets_ = [21,22,23,24,25,26,27,29,30,31,35,36,37,41,42,43];
                var targets_ = [];

                function init_table() {
                    dt_ = $('#ddd').DataTable({
                        //paging: false,
                        pageLength:-1,
                        serverSide: false,
                        lengthChange: false, //是否允许用户改变表格每页显示的记录数，显示条数组件
                        ordering: false, //是否启用排序组件，优先级高于columns中的排序控制；
                        searching: false,
                        scrollY: "200px", //可选，是否固定表格高度，不包括表头；
                        scrollX: true, //可选是否显示水平滚动条；默认false;
                        scrollCollapse: true,
                        fixedColumns: { //可选，锁定左侧、右侧各两列，需引用列冻结包
                            leftColumns: 4,
                            /*drawCallback: function(settings) {
                                console.log('fixedColumns-drawCallback-ok')
                            }*/
                        },
                        info: false,
                        deferRender: true,
                        scroller: {
                            displayBuffer: 2,
                            loadingIndicator: true,
                            boundaryScale: 0.75
                        },
                        ajax: {
                            url: '/dt/api/test',
                            "data": {
                                "num": num_
                            }
                        },
                        columns: aar,
                        initComplete: function(settings, json) {
                            console.log('init-ok');
                            $('#js_overlay').addClass('hidden');
                        },
                        drawCallback: function(settings) {
                            console.log('drawCallback-ok')
                        },
                        "columnDefs": [{
                            "visible": false,
                            "targets": targets_
                        }],
                        "destroy": true
                    });
                }
                init_table();

                $('.js-cell-btn').click(function() {
                    $('#js_overlay').removeClass('hidden');
                    var that = $(this);
                    var action = that.data('action');
                    if(action){
                        action = action.split(',');
                        window.setTimeout(function() {
                            if(that.data('btn_status') == 'true') {
                                dt_.columns(action).visible(false);
                                that.data('btn_status', 'false').toggleClass('glyphicon-minus-sign').toggleClass('glyphicon-plus-sign');
                            } else {
                                that.data('btn_status', 'true').toggleClass('glyphicon-plus-sign').toggleClass('glyphicon-minus-sign');
                                dt_.columns(action).visible(true);
                            }
                        }, 50);
                    }
                });
                
                window.dt_ = dt_;

                var overlay_time_ = null;

                $('#ddd').on('column-visibility.dt', function(e, settings, column, state) {
                    if(overlay_time_) {
                        window.clearTimeout(overlay_time_);
                    }
                    var overlay_time_ = window.setTimeout(function() {
                        $('#js_overlay').addClass('hidden');
                    }, 200);
                    console.log(
                        'Column ' + column + ' has changed to ' + (state ? 'visible' : 'hidden')
                    );
                });
                
                $('.js-cus-btn').click(function() {
                    var t = $(this).data('item');
                    $('#js_overlay').removeClass('hidden');
                    if(t == 1) {
                        num_ = 20;
                        targets_ = default_targets_.concat([2,3]);
                    } else if(t == 2) {
                        num_ = 120;
                        targets_ = default_targets_.concat([3]);
                    } else {
                        num_ = 500;
                        targets_ = default_targets_.concat([]);
                    }
                    window.setTimeout(function() {
                        init_table();
                    }, 50);
                });
            });
        </script>
        <div class="js-overlay hidden" id="js_overlay" style="position: fixed; z-index: 999; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,.3);">
            <i class="glyphicon glyphicon-refresh cus-animation-spin" style="position: absolute; left: 50%; top: 50%; font-size: 40px; color: #fff;"></i>
        </div>
    </body>

</html>