<!doctype html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>jstree-demo</title>

<link href="../css/bootstrap.min.css" rel="stylesheet">
<!--<link href="../font-awesome/css/font-awesome.css" rel="stylesheet">-->
<link href="../css/plugins/jsTree/style.min.css" rel="stylesheet">
<link rel="stylesheet" href="../css/iconfont.css" type="text/css"/>

<link href="../css/animate.css" rel="stylesheet">
<style>
    pre {
        white-space: pre-wrap;
        white-space: -moz-pre-wrap;
        white-space: -pre-wrap;
        white-space: -o-pre-wrap;
        word-wrap: break-word;
        height: 400px;
        overflow: auto;
    }

    .demo-box {
        margin-bottom: 10px;
        border: 1px solid #ddd;
        padding: 10px;
        position: relative;;
    }
</style>
<body>
<div class="container">
    <!-- 实例5开始 -->
    <div class="panel panel-default">
        <div class="panel-heading">四、json数据加载</div>
        <div class="panel-body">
            <div class="demo-box">
                <div class="input-group " style="width:200px;">
                    <input id="plugins4_q" type="text" class="form-control">
                    <span class="input-group-btn"><button type="button" class="btn" id="search">搜索</button></span>
                </div>
                <div id="jstree5"></div>
            </div>
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#demo1-htm4" role="tab" data-toggle="tab">html</a></li>
                <li role="presentation"><a href="#demo4-js" role="tab" data-toggle="tab">js</a></li>
                <li role="presentation"><a href="#demo4-css" role="tab" data-toggle="tab">css</a></li>
                <li role="presentation"><a href="#demo4-data" role="tab" data-toggle="tab">data</a></li>
            </ul>
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="demo1-htm4">
<pre>
&lt;div id="jstree4"&gt; &lt;/div&gt;
</pre>
                </div>
                <div role="tabpanel" class="tab-pane" id="demo4-js">
<pre>
&lt;script src=&quot;js/jquery-2.1.1.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/jstree.min.js&quot;&gt;&lt;/script&gt;
$(function () {
    $(&#x27;#jstree4&#x27;).jstree({
        &#x27;core&#x27; : {
            &#x27;data&#x27; : {
                //&#x27;url&#x27; : &#x27;url&#x27;,
                &#x27;url&#x27; : function (node) {
                    return node.id === &#x27;0&#x27; ?
                        &#x27;demo-tree-data-root.json&#x27; :
                        &#x27;demo-tree-data-child.json&#x27;;
                },
                &#x27;data&#x27; : function (node) {
                    return { &#x27;id&#x27; : node.id };
                }
            }
        },
        &#x27;plugins&#x27; : [&#x27;checkbox&#x27;,&#x27;wholerow&#x27;]
    });

})	
</pre>
                </div>
                <div role="tabpanel" class="tab-pane" id="demo4-css">
<pre>
&lt;link href="../css/plugins/jsTree/style.min.css" rel="stylesheet"&gt;
</pre>
                </div>
                <div role="tabpanel" class="tab-pane" id="demo4-data">
<pre>
// AJAX
$('#tree').jstree({
    'core' : {
        'data' : {
            'url' : '/get/children/',
            'data' : function (node) {
                return { 'id' : node.id };
            }
        }
    });
### ps 
[
{ "text" : "ajax-Child 1","icon":"tedufont tedu-icon85","children" : true}, 
{ "text" : "state-Child 2","icon":"tedufont tedu-icon85", "children" : ["One more"] }
]


//静态 data #1：
$('#using_json').jstree({
    'core' : {
        'data' : [
            {
                'id' : 'node_2',
                'text' : 'Root node with options',
                'state' : { 'opened' : true, 'selected' : true },
                'children' : [ { 'text' : 'Child 1' }, 'Child 2']
            }
        ]
    }
});

###  PS：
{
  id          : "string" // will be autogenerated if omitted
  text        : "string" // node text
  icon        : "string" // string for custom
  state       : {
    opened    : boolean  // is the node open
    disabled  : boolean  // is the node disabled
    selected  : boolean  // is the node selected
  },
  children    : []  // array of strings or objects
  li_attr     : {}  // attributes for the generated LI node
  a_attr      : {}  // attributes for the generated A node
}


//静态 data #2：list child=> parent
$('#using_json_2').jstree({ 'core' : {
    'data' : [
       { "id" : "ajson1", "parent" : "#", "text" : "Simple root node" },
       { "id" : "ajson2", "parent" : "#", "text" : "Root node 2" },
       { "id" : "ajson3", "parent" : "ajson2", "text" : "Child 1" },
       { "id" : "ajson4", "parent" : "ajson2", "text" : "Child 2" },
    ]
} });

###  PS：
{
  id          : "string" // required
  parent      : "string" // required
  text        : "string" // node text
  icon        : "string" // string for custom
  state       : {
    opened    : boolean  // is the node open
    disabled  : boolean  // is the node disabled
    selected  : boolean  // is the node selected
  },
  li_attr     : {}  // attributes for the generated LI node
  a_attr      : {}  // attributes for the generated A node
}
</pre>
                </div>
            </div>
        </div>
    </div>
    <!-- 实例5 结束 -->
</div>


<script src="../js/jquery-2.1.1.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/plugins/jsTree/jstree.min.js"></script>
<!-- Custom and plugin javascript -->
<script src="../js/plugins/layer/layer.js"></script>
<script src="../i18n/zh-CN.js" ></script>
<!--<script src="../js/jquery.hash.min.js"></script>-->
<!--<script src="../js/inspinia-ajax.js"></script>-->
<script src="../js/subindex.js"></script>
<!--<script src="../js/plugins/pace/pace.min.js"></script>-->

<script>
    $(function () {
        TEDU_MESSAGE.set( {
            JTsel_node: {"zh-CN":'请选择节点!'},
            JTmo_tit: {"zh-CN":'请输入图标及内容!'},
            JTr_tit: {"zh-CN":'请修改图标及内容!'},
            JTr_notdel: {"zh-CN":'不能删除此节点!'},
            JTaddn_node: {"zh-CN":'添加下级节点'},
            JTaddb_node: {"zh-CN":'添加同级节点'},
            JTrename_node: {"zh-CN":'修改节点'},
            JTdel_node: {"zh-CN":'删除节点'}
        });
        var i1, ref,node_;
        function saveFun(obj, editNum) {
//            ref.refresh_node(node_);
//            ref.open_node(node_);
            /*$.ajax({
             url:'',
             type:'',
             success:function () {
             //...执行创建
             },
             error:function () {

             }
             })*/
            if (editNum == 0) {
                ref.create_node(node_, {"icon": obj['icon'], "text": obj['text']/*,"children" : true*/}/*,function(){
                    alert(2)
                }*/);//创建节点
                 ref.open_node(node_);
            } else if (editNum == 1) {
                ref.set_icon(node_, obj['icon']);//更改节点icon
                ref.set_text(node_, obj['text']);//更改节点内容
            }
        }

        var treeObjList = {
            editFunc: function (tit, url_) {//重命名节点  tit:弹框标题,url,弹框路径.此处需要url透传数据
                i1 = cumParentWinModal(tit, url_, {
                    "type": 2,
                    'area': ['380px', '240px']
                })
            },
            create: function () {
                if (!node_.length) {
                    COM_TOOLS.alert(LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTsel_node"]);
                    return false;
                }
                treeObjList.editFunc(TEDU_MESSAGE.get('JTmo_tit'), ['add-icon.html?edit=0'])
            },
            rename: function () {
                if (!node_.length) {
                    COM_TOOLS.alert(LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTsel_node"]);
                    return false;
                }
                var iconRename = encodeURI($.trim(ref.get_icon(node_)));
                var textRename = encodeURI($.trim(ref.get_text(node_)));
                treeObjList.editFunc(LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTr_tit"], ['add-icon.html?edit=1&nodeName=' + textRename + '&iconRename=' + iconRename])
            },
            del: function () {
                if (!node_.length) {
                    COM_TOOLS.alert(LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTsel_node"]);
                    return false;
                }
                COM_TOOLS.confirm("确认删除吗？", function (index) {
                    cumCloseWin(index);
                    ref.delete_node(node_);
                });
            }
        };
        $('#jstree5').jstree({
            'core': {
                "check_callback": true,
                'data': {
                    //'url' : 'url',
                    'url': function (node) {
                        return node.id === '0' ?
                            'demo-tree-data-root.json' :
                            'demo-tree-data-child.json';
                    },
                    'data': function (node) {
                        return {'id': node.id};
                    }
                }
            }, 'contextmenu': {
                show_at_node: false,
                items: function (node) {
                    var temp = {
                        "add_c": {
                            "icon": 'glyphicon glyphicon-asterisk',
                            "label": LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTaddn_node"],
                            "separator_after": true,//表示在此项之后是否应该有分隔符
                            "action": function (data) {
                                var pathL = node.parents.length;
                                alert("我是" + pathL + "级节点");
                                ref = $('#jstree5').jstree(true);
                                node_ = node.id;
                                treeObjList.create();
                            }
                        },
                        "add_b": {
                            "icon": 'glyphicon glyphicon-asterisk',
                            "label": LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTaddn_node"],
                            "separator_after": true,//表示在此项之后是否应该有分隔符
                            "action": function (data) {
                                ref = $('#jstree5').jstree(true);
                                node_ = node.parents[0];
                                treeObjList.create();
                            }
                        },
                        "rename": {
                            "icon": 'glyphicon glyphicon-pencil',
                            "label": LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTrename_node"],
                            "separator_after": true,//表示在此项之后是否应该有分隔符
                            "action": function (data) {
                                ref = $('#jstree5').jstree(true);
                                node_ = node.id;
                                treeObjList.rename();
                            }
                        },
                        "del": {
                            "icon": 'glyphicon glyphicon-remove',
                            "label":  LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTdel_node"],
                            "separator_after": true,//表示在此项之后是否应该有分隔符
                            "action": function (data) {
                                var typeid_ = node.li_attr.typeid;
                                var pathL = node.parents.length;
                                if (pathL < 2 || typeid_) {
                                    COM_TOOLS.alert(LOCAL_MESSAGE_DATA["platform.plugin.jtree.JTr_notdel"]);
                                    return false;
                                }
                                ref = $('#jstree5').jstree(true);
                                node_ = node.id;
                                treeObjList.del();
                            }
                        }
                    }
                    return temp;
                }
            },
            'plugins': ['wholerow', 'contextmenu', "search"]
        });
        var to_ = false;
        $('#search').click(function () {
            if (to_) {
                clearTimeout(to_);
            }
            to_ = setTimeout(function () {
                var v = $('#plugins4_q1').val();
                $('#jstree5').jstree(true).search(v); //搜索
            }, 250);
        });
        COM_TOOLS.private_obj_.saveFun = saveFun;
    })
</script>
</body>
</html>
