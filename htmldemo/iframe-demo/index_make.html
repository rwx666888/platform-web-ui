<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>平台首页定制化</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/style.css">
        <link rel="stylesheet" href="../../js/plugins/layer/skin/default/layer.css?v=3.1.1" id="layuicss-layer">
        <style type="text/css">
            .cus-creat-page {
                padding: 10px 50px 10px 170px;
                position: relative;
            }
            .cus-creat-page .control-box {
                position: absolute;
                top: 10px;
                left: 0;
                width: 150px;
            }
            .cus-creat-page .control-box .panel-body {
                padding: 10px 8px;
            }
            .cus-creat-page .js-creat-box {
                padding: 30px 10px 10px;
                border: 1px solid #DDDDDD;
                border-radius: 5px;
                position: relative;
                word-wrap: break-word;
                min-height: 100px;
            }
            .cus-creat-page .js-creat-box:before {
                background-color: #F9F9F9;
                border: 1px solid #DDDDDD;
                border-radius: 5px 0;
                color: #9DA0A4;
                content: "Container";
                font-weight: bold;
                left: -1px;
                padding: 3px 7px;
                position: absolute;
                top: -1px;
            }
            .cus-creat-page .js-creat-box .row {
                background-color: #F9F9F9;
                -webkit-box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.1);
                -moz-box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.1);
                box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.1);
                border: 1px solid #DDDDDD;
                border-radius: 5px;
                margin: 5px 0;
                position: relative;
                padding: 30px 5px 7px;
            }
            .cus-creat-page .js-creat-box .row:before {
                background-color: #F9F9F9;
                border: 1px solid #DDDDDD;
                border-radius: 3px 0;
                color: #9DA0A4;
                content: "Row";
                font-size: 12px;
                font-weight: bold;
                left: -1px;
                line-height: 2;
                padding: 3px 7px;
                position: absolute;
                top: -1px;
            }
            .cus-creat-page .js-model-item {
                position: relative;
                /*padding-top: 30px;*/
            }
            .cus-creat-page .js-btn-box {
                position: absolute;
                top: 5px;
                right: 15px;
            }
            .cus-creat-page .cus-col-box .js-btn-box {
                top: 10px;
            }
            .cus-creat-page .js-btn-box>.label {
                margin-left: 5px;
            }
            .cus-creat-page .js-model-item .js-btn-box {
                opacity: 0.4;
            }
            .cus-creat-page .js-model-item:hover>.js-btn-box {
                opacity: 1;
            }
            .cus-creat-page .js-btn-box .js-evt-btnbar[data-active="move"] {
                cursor: move;
            }
            .cus-creat-page .js-btn-box .js-evt-btnbar[data-active="del"],
            .cus-creat-page .js-btn-box .js-evt-btnbar[data-active="config"] {
                cursor: pointer;
            }
            /*.cus-creat-page .cus-col-box:before {
                background-color: #F9F9F9;
                border: 1px solid #DDDDDD;
                border-radius: 3px 0;
                color: #9DA0A4;
                content: "Column";
                font-size: 12px;
                font-weight: bold;
                left: -1px;
                padding: 3px 7px;
                position: absolute;
                top: -1px;
            }*/
            
            .cus-creat-page .add-item-btn {
                padding: 4px 8px;
                border-radius: 3px;
                background-color: #bcefbc;
                cursor: pointer;
                line-height: 22px;
            }
            .cus-creat-page .add-item-btn:hover {
                background-color: #CDFFCD;
            }
            .cus-creat-page .cus-col {
                padding: 0 8px;
            }
            .cus-creat-page .cus-col-box {
                margin: 5px 0;
                position: relative;
                min-height: 44px;
            }
            .cus-creat-page .cus-col-box.no-item,
            .cus-creat-page .cus-col-box:empty {
                border: 1px dashed #ddd;
                border-radius: 3px;
                background-color: #fffbf5;
            }
            .panel-config-box .input-group-addon {
                background-color: #eee;
            }
            .panel-config-box .c-tip {
                font-size: 12px;
            }
            .panel-config-box .skin-list {
                position: relative;
                float: left;
                margin: 0 10px 0 0;
                cursor: pointer;
            }
            .panel-config-box .skin-list input[type="radio"] {
                position: absolute;
                left: 0;
                top: 0;
                opacity: 0;
                z-index: 1;
            }
            .panel-config-box .skin-list .cus-panel {
                margin: 0;
                width: 40px;
                padding: 2px;
            }
            .panel-config-box .cus-panel-heading {
                position: relative;
                border-bottom: none;
            }
            .panel-config-box .cus-panel-heading .c-icon {
                display: none;
                position: absolute;
                top: 3px;
                right: 9px;
                font-size: 14px;
            }
            .panel-config-box input[type="radio"]:checked+.cus-panel .c-icon {
                display: inline-block;
            }
            /* 构造视图下，panel样式修正 */
            
            .cus-creat-page .cus-col-box .cus-panel-btn-box {
                right: 180px;
            }
            .cus-creat-page .cus-col-box .fullscreen .cus-panel-btn-box {
                right: 15px;
            }
            .cus-creat-page .cus-panel-btn-box .c-p-btn[data-active="close"] {
                display: none;
            }
        </style>
    </head>

    <body>
        <div id="js_main_area" class="cus-creat-page">
            <div class="control-box">
                <div class="panel panel-default">
                    <div class="panel-heading">操作面板</div>
                    <div class="panel-body">
                        <button class="btn btn-sm btn-primary btn-block" id="save_btn">保存</button>
                        <button class="btn btn-sm btn-success btn-block" id="cancel_btn">取消</button>
                    </div>
                </div>

            </div>
            <div class="js-creat-box container-fluid">
                <div class="sort-itme show js-subdiv-col" id="js_main_cbox">
                    <div class="js-model-item">
                        <div class="js-code-box">
                            <div class="row">
                                <div class="col-md-6 cus-col">
                                    <div class="cus-col-box js-model-col">

                                        <div class="js-model-item">
                                            <div class="js-code-box">
                                                <div class="cus-panel cus-panel-success" data-height="300px" data-iframesrc="index_default.html">
                                                    <div class="cus-panel-heading">
                                                        <span class="cus-panel-title">Panel title</span>
                                                        <div class="cus-panel-btn-box">
                                                            <!--<span class="c-p-btn js-evt-btnbar" data-active="fullscreen">
                                                                <i class="glyphicon glyphicon-resize-full"></i>
                                                            </span>
                                                            <span class="c-p-btn js-evt-btnbar" data-active="reload">
                                                                <i class="glyphicon glyphicon-refresh"></i>
                                                            </span>
                                                            <span class="c-p-btn js-evt-btnbar" data-active="collapse">
                                                                <i class="glyphicon glyphicon-chevron-up"></i>
                                                            </span>
                                                            <span class="c-p-btn js-evt-btnbar" data-active="close">
                                                                <i class="glyphicon glyphicon-remove"></i>
                                                            </span>-->
                                                        </div>
                                                    </div>
                                                    <div class="cus-panel-body iframe-panel"></div>
                                                    <!--<div class="panel-overlay">
                                                        <div class="panel-overlay-loading"><i class="glyphicon glyphicon-refresh cus-animation-spin"></i></div>
                                                    </div>-->
                                                </div>
                                            </div>
                                            <div class="js-btn-box">
                                                <div class="btn-group btn-group-xs">
                                                    <button class="btn btn-default">配置</button>
                                                    <button class="btn btn-default">btn1</button>
                                                </div>
                                                <span class="label label-danger js-evt-btnbar" data-active="del"><i class="glyphicon glyphicon-remove"></i>删除</span>
                                                <span class="label label-warning js-evt-btnbar" data-active="move"><i class="glyphicon glyphicon-move"></i>拖动</span>
                                            </div>
                                        </div>

                                        <div class="js-model-item js-md-col">
                                            <div class="js-code-box">
                                                <div class="cus-panel cus-panel-success">
                                                    <div class="cus-panel-heading">
                                                        <span class="cus-panel-title">Panel title</span>
                                                        <div class="cus-panel-btn-box"></div>
                                                    </div>
                                                    <div class="cus-panel-body">
                                                        Panel content
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="js-btn-box">
                                                <div class="btn-group btn-group-xs">
                                                    <button class="btn btn-default">配置</button>
                                                    <button class="btn btn-default">btn1</button>
                                                </div>
                                                <span class="label label-danger js-evt-btnbar" data-active="del"><i class="glyphicon glyphicon-remove"></i>删除</span>
                                                <span class="label label-warning js-evt-btnbar" data-active="move"><i class="glyphicon glyphicon-move"></i>拖动</span>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="add-item-btn">
                                        <div class="title-bar text-center js-add-item">添加模块</div>
                                    </div>
                                </div>
                                <div class="col-md-6 cus-col">
                                    <div class="cus-col-box js-model-col no-item">

                                    </div>
                                    <div class="add-item-btn text-center js-add-item">添加模块</div>
                                </div>
                            </div>
                        </div>
                        <div class="js-btn-box">
                            <!--<div class="btn-group btn-group-xs">
                                <button class="btn btn-default">配置</button>
                                <button class="btn btn-default">btn1</button>
                                <div class="btn-group btn-group-xs">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                    Dropdown
                                    <span class="caret"></span>
                                </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="#">Dropdown link</a>
                                        </li>
                                        <li>
                                            <a href="#">Dropdown link</a>
                                        </li>
                                        <li>
                                            <a href="#">Dropdown link</a>
                                        </li>
                                        <li>
                                            <a href="#">Dropdown link</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>-->
                            <span class="label label-info js-evt-btnbar" data-active="config"><i class="glyphicon glyphicon-cog"></i>设置</span>
                            <span class="label label-danger js-evt-btnbar" data-active="del"><i class="glyphicon glyphicon-remove"></i>删除</span>
                            <span class="label label-warning js-evt-btnbar" data-active="move"><i class="glyphicon glyphicon-move"></i>拖动</span>
                        </div>
                    </div>

                </div>
                <div class="add-item-btn text-center js-add-item" data-btntype="subdiv">添加区块</div>
            </div>
        </div>

        <br /><br /><br />
        <div class="panel-config-box" id="panel_config_box" style="width: 650px; margin: 0 auto; padding: 10px; display: none;">
            <div class="container-fluid">
                <form class="form-horizontal cus-form-format" onsubmit="return false;" autocomplete="off">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">皮肤：</label>
                        <div class="col-sm-8 input-group" style="padding-top: 5px;">
                            <label class="skin-list">
                                <input type="radio" name="className" value="cus-panel-default" checked="checked"/>
                                <div class="cus-panel cus-panel-default">
                                    <div class="cus-panel-heading">
                                        <i class="c-icon glyphicon glyphicon-ok"></i>
                                    </div>
                                </div>
                            </label>
                            <label class="skin-list">
                                <input type="radio" name="className" value="cus-panel-warning"/>
                                <div class="cus-panel cus-panel-warning">
                                    <div class="cus-panel-heading">
                                        <i class="c-icon glyphicon glyphicon-ok"></i>
                                    </div>
                                </div>
                            </label>
                            <label class="skin-list">
                                <input type="radio" name="className" value="cus-panel-primary"/>
                                <div class="cus-panel cus-panel-primary">
                                    <div class="cus-panel-heading">
                                        <i class="c-icon glyphicon glyphicon-ok"></i>
                                    </div>
                                </div>
                            </label>
                            <label class="skin-list">
                                <input type="radio" name="className" value="cus-panel-success"/>
                                <div class="cus-panel cus-panel-success">
                                    <div class="cus-panel-heading">
                                        <i class="c-icon glyphicon glyphicon-ok"></i>
                                    </div>
                                </div>
                            </label>
                            <label class="skin-list">
                                <input type="radio" name="className" value="cus-panel-info"/>
                                <div class="cus-panel cus-panel-info">
                                    <div class="cus-panel-heading">
                                        <i class="c-icon glyphicon glyphicon-ok"></i>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">高度：</label>
                        <div class="col-sm-5 input-group">
                            <input type="text" class="form-control" name="height">
                            <span class="input-group-addon">px</span>
                        </div>
                        <div class="col-sm-3 c-tip text-warning">数字；空为默认值</div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">面板边框：</label>
                        <div class="col-sm-5 input-group">
                            <input type="text" class="form-control" name="panelBorder">
                            <span class="input-group-addon">px</span>
                        </div>
                        <div class="col-sm-3 c-tip text-warning">数字；无边框填0或none，空为默认值</div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">标题栏显隐：</label>
                        <div class="col-sm-5 input-group">
                            <select class="form-control" name="headHidden">
                                <option value="false">显示</option>
                                <option value="true">隐藏</option>
                            </select>
                        </div>
                        <div class="col-sm-3 c-tip text-warning"></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">标题栏底部边框：</label>
                        <div class="col-sm-5 input-group">
                            <input type="text" class="form-control" name="headBorder">
                            <span class="input-group-addon">px</span>
                        </div>
                        <div class="col-sm-3 c-tip text-warning">数字；无边框填0或none，空为默认值</div>
                    </div>
                    <div class="form-group text-center">
                        <button type="button" class="btn btn-primary btn-sm" id="js_config_savebtn">提交</button>
                    </div>
                </form>
            </div>
        </div>

        <script src="../../js/jquery-2.1.1.js" type="text/javascript"></script>
        <script src="../../js/bootstrap.min.js" type="text/javascript"></script>
        <script src="../../js/jquery-ui.1.12.1.sort.custom.min.js" type="text/javascript"></script>
        <script src="../../i18n/zh-CN.js"></script>
        <script src="../../js/plugins/layer/layer.js" type="text/javascript"></script>
        <script src="../../js/subindex.js" type="text/javascript"></script>

        <!-- 演示使用 -->
        <script src="../../js/jquery.mockjax.min.js" type="text/javascript"></script>
        <script src="../../demo-data.js" type="text/javascript"></script>
        <script src="../../js/portal_admin.js" type="text/javascript"></script>
        <script>
            $(function() {
                var cur_pageid_ = COM_TOOLS.requestParam('pageid') || 'page1001';

                function sortable_fn(selector) {
                    var $str = '#js_main_area ' + selector;
                    var $iframeBlocks;
                    $($str).sortable({
                        connectWith: $str, // 区域控制(上下一样)
                        handle: '.js-evt-btnbar[data-active="move"]',
                        tolerance: 'pointer', //指定用于测试项目被移动时是否覆盖在另一个项目上的模式,"pointer"：鼠标指针重叠在其他项目上。
                        //opacity: 0.4,
                        /*change: function(evt, ui) {
                            console.log('change', ui.sender, $(evt.target), ui.placeholder.parent());
                            if(ui.sender) {
                                if($(ui.sender).children().length == 1) {
                                    $(ui.sender).addClass('no-item');
                                }
                            }
                        },*/
                        receive: function(evt, ui) { // 当来自一个连接的 sortable 列表的一个项目被放置到另一个列表时触发该事件。后者是事件目标。
                            //console.log('receive', $(evt.target).parent('.cus-col').attr('id'));
                            var parent_id_ = $(evt.target).parent('.cus-col').attr('id');
                            if(parent_id_){
                                $(ui.item).attr('data-parent_id',parent_id_).data('parent_id',parent_id_);
                            }
                            /*if($(evt.target).children().length) {
                                $(evt.target).removeClass('no-item');
                            }*/
                        },
                        start: function(evt, ui) {
                            $iframeBlocks = $('iframe:visible').map(function() { //参照jquery UI 解决iframe拖拽卡顿问题的源码
                                var iframe = $(this);
                                return $("<div>")
                                    .css({
                                        position: "absolute",
                                        width: iframe.outerWidth(),
                                        height: iframe.outerHeight(),
                                        //background: '#f0f'
                                    })
                                    .appendTo(iframe.parent())
                                    .offset(iframe.offset())[0];
                            });
                        },
                        stop: function(evt, ui) {
                            if($iframeBlocks) { //参照jquery UI 解决iframe拖拽卡顿问题的源码
                                $iframeBlocks.remove();
                                $iframeBlocks = false;
                            }
                        },
                        placeholder: false
                    });
                }

                var _style_api = COM_TOOLS._model.panel.makePanelStyle(); //获取面板样式构造器实例

                function _makeid_fn() {
                    return COM_TOOLS.get_GUID();
                }

                function make_one_subdiv(data) {
                    var id = data.id;
                    if(!id) {
                        return false;
                    }
                    $subdiv = $(data.html);
                    $subdiv.children('.cus-col').each(function(i, n) {
                        $(n).attr('id', _makeid_fn());
                    });
                    return {
                        id: _makeid_fn(),
                        modelid: data.id,
                        parent: cur_pageid_,
                        type: 1,
                        html: $subdiv
                    };
                }
                /**
                 * 添加一个区块
                 * @param {Object} data 区块数据
                 * @param {Object} $target 待添加到的目标对象（jq）
                 */
                function add_one_subdiv(data, $target) {
                    if(data.html) {
                        var $html = $.type(data.html) == 'string' ? $(data.html) : data.html;
                        $html.children('.cus-col').html('<div class="cus-col-box js-model-col"></div><div class="add-item-btn text-center js-add-item" data-btntype="panel">添加模块</div>');
                        ($target ? $target : $('#js_main_cbox')).append(COM_TOOLS._model.panel.model_wrap($html, data.id, data.modelid, data.parent, 1));
                    }
                }

                window.make_one_subdiv = make_one_subdiv;
                window.sortable_fn = sortable_fn;

                function init_fn(t_data) {
                    var $subdiv = $('<div/>');
                    $.each(t_data.subdiv, function(i, n) { //初始化区块
                        add_one_subdiv(n, $subdiv);
                    });

                    $.each(t_data.modelist, function(j, m) { //初始化模块
                        COM_TOOLS._model.panel.add_one_panel(m, $subdiv, 'makeAndCache');
                        _style_api.addStyle(m.id, m.skin);
                    });
                    _style_api.useStyle(); //先注入样式，再插入dom节点
                    $('#js_main_cbox').html($subdiv.children());
                    $subdiv = null;
                }

                /* 初始化数据 */
                COM_TOOLS.ajaxFn({
                    url: '/get/panel/page',
                    data: {
                        pageid: cur_pageid_
                    },
                    success: function(d) {
                        init_fn(d);
                        sortable_fn('.js-subdiv-col');
                        sortable_fn('.js-model-col');
                        $('#js_main_cbox .cus-panel').cuspanel();
                    }
                }, 1, false);

                $('#js_main_area').on('click', '.js-add-item', function() {
                    var $that = $(this);
                    var type = $that.data('btntype');
                    var $thisCol = $that.parent('.cus-col');
                    /* if(type == 'subdiv') { //区块
                        
                    } else if(type == 'panel') { //面板
                        
                    } */
                    // 模板弹窗
                    cumParentWinModal('模板选择', '../iframe-demo/180824_tpl.html?type=' + type, {
                        "scrollbar": true,
                        "callback": {
                            cus_make: function(modelData) {
                                if(type == 'subdiv') { //区块
                                    var data_ = make_one_subdiv(modelData);
                                    data_ && add_one_subdiv(data_, false);
                                    sortable_fn('.js-model-col');
                                } else if(type == 'panel') { //面板
                                    var mdata = {
                                        id: COM_TOOLS.get_GUID(),
                                        modelid: modelData.id,
                                        parent: $thisCol.attr('id'),
                                        name: modelData.name,
                                        type: modelData.type,
                                        url: modelData.url,
                                        skin: {}
                                    };
                                    COM_TOOLS._model.panel.add_one_panel(mdata, $thisCol, 'makeOne');
                                }
                            }
                        }
                    });

                });

                $('#js_main_cbox').on('click', '.js-evt-btnbar[data-active="config"]', function() {
                    var $that = $(this);
                    var $model_wrap = $that.closest('.js-model-item');
                    var skinObj = $model_wrap.data('skin');
                    var wrapitem_id = $model_wrap.data('wrapitem_id');
                    var $form = $('#panel_config_box form');
                    $form[0].reset();
                    if(!wrapitem_id) {
                        COM_TOOLS.alert2('参数错误！');
                        return false;
                    }
                    cumCurWinModal(false, $('#panel_config_box'), self, {
                        type: 1,
                        area: ['650px', 'auto'],
                        success: function(layero, ind_) {
                            $.each(skinObj, function(i, n) {
                                var $ele = $form.find('[name="' + i + '"]');
                                if($ele.attr('type') == 'radio') {
                                    $ele.filter('[value="' + n + '"]').prop('checked', true);
                                } else if($ele.attr('type') == 'text' || $ele[0].tagName.toLowerCase() == 'select') {
                                    $ele.val(n)
                                }
                            });
                            layero.data('wrapitem_id', wrapitem_id);
                        },
                        end: function() {
                            $form[0].reset();
                        }
                    });
                    return false; //必须
                }).on('click', '.js-evt-btnbar[data-active="del"]', function() {
                    $(this).closest('.js-model-item').remove();
                });

                $('#js_config_savebtn').click(function() {
                    var $layer_ = $(this).closest('.layui-layer');
                    var wrapitem_id = $layer_.data('wrapitem_id');
                    if(!wrapitem_id) {
                        COM_TOOLS.alert2('参数错误！');
                        return false;
                    }
                    var classArr_ = [];
                    $('#panel_config_box [name="className"]').each(function() {
                        classArr_.push($.trim($(this).val()));
                    });

                    var config_ = COM_TOOLS.serializeObject($('#panel_config_box form'));
                    _style_api.addStyle(wrapitem_id, config_); //更新样式
                    _style_api.useStyle();
                    var $model = $('[data-wrapitem_id="' + wrapitem_id + '"]');
                    var $panel = $('[data-itemid="' + wrapitem_id + '"]');
                    $model.length && $model.data('skin', config_);
                    if($panel.length) {
                        $panel.removeClass(classArr_.join(' ')).addClass(config_.className)
                    }
                    layer.close($layer_.attr('times'));
                });

                function get_format_data() { //获取构造数据
                    var dataList = [];
                    var errorFlag_ = false;
                    var subdivOrder = 0;
                    var subdivCache = {};
                    $('.js-model-item').each(function(i, n) {
                        var $that = $(this);
                        var data_ = $that.data();
                        if(data_ && data_.wrapitem_id && data_.model_id && data_.parent_id && $.type(data_.model_type) != 'undefined') {
                            var childCol = [];
                            var newData = {
                                model_id: data_.model_id,
                                wrapitem_id: data_.wrapitem_id,
                                parent_id: data_.parent_id,
                                model_type: data_.model_type
                            };
                            if(data_.model_type == '1') { //区块
                                $cols = $that.children('.js-code-box').children('.row').children('.cus-col');
                                $cols.each(function(j, m) {
                                    childCol.push({
                                        id: $(m).attr('id'),
                                        order: j
                                    });
                                });
                                newData.child_col = childCol;
                                newData.order = subdivOrder++;
                            } else if(data_.model_type == '3') { //面板
                                if(!subdivCache[data_.parent_id]) {
                                    subdivCache[data_.parent_id] = [data_.wrapitem_id];
                                } else {
                                    subdivCache[data_.parent_id].push(data_.wrapitem_id);
                                }
                                newData.order = subdivCache[data_.parent_id].length - 1;
                                newData.skin = data_.skin;
                            }
                            dataList.push(newData);
                        } else {
                            errorFlag_ = true;
                            return false;
                        }
                    });
                    if(!errorFlag_) {
                        return dataList;
                    } else {
                        COM_TOOLS.alert2('数据结构发生内部错误，请联系管理员！');
                        return false;
                    }
                }
                window.get_format_data = get_format_data;

                $('#save_btn').click(function() { //保存数据
                    var mdata = get_format_data();
                    if(mdata) {
                        COM_TOOLS.ajaxFn({
                            url: '/set/panel/page',
                            data: {
                                pageid: cur_pageid_,
                                modeldata: JSON.stringify(mdata) //转为json字符串类型
                            },
                            success: function(d) {
                                COM_TOOLS.alert('保存成功！');
                            }
                        }, 1, false);
                    }
                });
            });
        </script>
        <script>
            /* 提交给后台的数据结构 */
            var demo_yy = [{
                "model_id": "d100", //tab_page_subdiv_re => subdivid
                "wrapitem_id": "re_pd100", //tab_page_subdiv_re => page_subdiv_reid; tab_subdiv_tple => page_subdiv_reid
                "parent_id": "page1001", //tab_page_subdiv_re => pageid; tab_subdiv_tple => pageid;
                "model_type": 1, //区块
                "child_col": [{
                    "id": "d101", //tab_subdiv_tple => subdiv_tpleid
                    "order": 0 //tab_subdiv_tple => order
                }, {
                    "id": "d102",
                    "order": 1
                }],
                "order": 0 //tab_page_subdiv_re => order
            }, {
                "model_id": "m100", //tab_subdiv_templet_re => templetid
                "wrapitem_id": "re_md100", //tab_subdiv_templet_re => subdiv_templet_reid
                "parent_id": "d101", // tab_subdiv_tple =>  subdiv_tpleid
                "model_type": 3, //模块
                "order": 0, //tab_subdiv_templet_re => order
                "skin": { //tab_cusconfig
                    "className": "cus-panel-success", //皮肤
                    "panelBorder": "3", //面板边框
                    "headHidden": "true", //是否隐藏标题栏
                    "height": "100", //高度
                    "headBorder": "0" //标题栏边框
                }
            }];
        </script>
    </body>

</html>