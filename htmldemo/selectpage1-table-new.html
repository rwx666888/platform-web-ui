<!doctype html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>咨询顾问</title>

<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="../font-awesome/css/font-awesome.css" rel="stylesheet">

<link href="../css/plugins/customScrollbar/jquery.mCustomScrollbar.min.css" rel="stylesheet">

<link href="../css/plugins/iCheck/custom.css" rel="stylesheet">
<link href="../js/plugins/datatables/DataTables-1.10.12/css/dataTables.bootstrap.css" rel="stylesheet">
<link href="../js/plugins/datatables/Select-1.2.0/css/select.bootstrap.min.css" rel="stylesheet">
<link href="../css/animate.css" rel="stylesheet">
<link href="../css/style.css" rel="stylesheet">

<body>

<div class="col-xs-12 pt-8">
    <form class="form-inline">
        <div class="form-group m-r-md" style="display: inline-block; margin-bottom:0;">
            <label>名称：</label>
            <input type="text" class="form-control" placeholder="名称" style="width: auto; display: inline-block;">
        </div>
        <button class="btn btn-primary" type="button" id="searchBtn">搜索</button>
        <button class="btn btn-danger " type="button" id="empty">清空已选</button>
        <!--<button class="btn btn-primary" type="button">关闭</button>-->
    </form>
</div>
<div style="width:100%;padding-right: 220px;padding-left: 14px;">
    <table id="example1" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%">
        <thead>
        <tr>
            <th>序号</th>
            <th><span class="cus-checkbox-all"></span></th>
            <th>姓名</th>
            <th>客户类型</th>
            <th>下次回访日期</th>
        </tr>
        </thead>
    </table>
</div>
<style>
    #name_box span {
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 2px 6px;
        margin-right: 6px;
        margin-bottom: 5px;
        font-size: 12px;
    }

    #name_box span i.glyphicon {
        color: #ee707d;
    }

    .name-box {
        width: 200px;
        position: fixed;
        top: 50px;
        right: 0;
        bottom: 20px;
        border: 1px solid #EBEBEB;
        padding-top: 41px;
    }

    .name-box .name-box-header {
        position: absolute;
        padding: 5px;
        text-align: right;
        border-bottom: 1px solid #EBEBEB;
        width: 100%;
        top: 0;
    }

    .name-box .name-box-cont {
        padding: 7px;
        padding-right: 0;
        overflow: auto;
        height: 100%;
    }

    .mCSB_inside > .mCSB_container {
        margin-right: 10px;
    }

    .mCSB_scrollTools {
        width: 10px;
    }

    /*.mCSB_outside+.mCSB_scrollTools {
        right: -5px;
    }*/
</style>
<div style="" class="name-box" id="name_box">
    <div class="name-box-header">
        <button id="save_all" class="btn btn-success btn-xs"> 保存 <i class="glyphicon glyphicon-floppy-saved"></i></button>
        <button id="remove_all" class="btn btn-danger btn-xs">清空 <i class="glyphicon glyphicon-trash"></i></button>
    </div>
    <div class="name-box-cont">
        <span class="tips-name" data-itemid="row_18">给号借口 <i class="glyphicon glyphicon-remove-circle"></i></span>
        <span class="tips-name" data-itemid="row_11">阿斯顿发 <i class="glyphicon glyphicon-remove-circle"></i></span>
        <span class="tips-name" data-itemid="row_20">预科 <i class="glyphicon glyphicon-remove-circle"></i></span>
    </div>
</div>
<!-- Mainly scripts -->
<script src="../js/jquery-2.1.1.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="../js/plugins/layer/layer.js"></script>

<!-- Custom and plugin javascript -->
<script src="../i18n/zh-CN.js"></script>
<script src="../js/plugins/datatables/datatables.min.js"></script>
<script src="../js/plugins/customScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="../js/subindex.js"></script>

<script type="text/javascript" src="../js/jquery.mockjax.min.js"></script>
<script>

</script>
<script>
    //模拟交互数据
    var dt_data_ = {
        "draw": 1,
        "recordsTotal": 157,
        "recordsFiltered": 157,
        "data": [
            {
                "DT_RowId": "row_3",
                "DT_RowData": {
                    "pkey": 3
                },
                "first_name": "王大拿",
                "last_name": "Ramos",
                "position": "System Architect 111",
                "office": "London",
                "start_date": "9th Oct 09",
                "salary": 28875.11,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            },
            {
                "DT_RowId": "row_17",
                "DT_RowData": {
                    "pkey": 17
                },
                "first_name": "发个黄金分割",
                "last_name": "Cox",
                "position": "Technical Author 211",
                "office": "San Francisco",
                "start_date": "12th Jan 09",
                "salary": 4800.002,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            }
            ,
            {
                "DT_RowId": "row_13",
                "DT_RowData": {
                    "pkey": 17
                },
                "first_name": "西北风不刮",
                "last_name": "Cox",
                "position": "Technical Author333",
                "office": "San Francisco",
                "start_date": "12th Jan 09",
                "salary": 150083003.014,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            },
            {
                "DT_RowId": "row_18",
                "DT_RowData": {
                    "pkey": 17
                },
                "first_name": "给号借口",
                "last_name": "Cox",
                "position": "Technical Author333",
                "office": "San Francisco",
                "start_date": "12th Jan 09",
                "salary": 150083003.014,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            },
            {
                "DT_RowId": "row_11",
                "DT_RowData": {
                    "pkey": 17
                },
                "first_name": "阿斯顿发",
                "last_name": "Cox",
                "position": "Technical Author333",
                "office": "San Francisco",
                "start_date": "12th Jan 09",
                "salary": 150083003.014,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            },
            {
                "DT_RowId": "row_19",
                "DT_RowData": {
                    "pkey": 17
                },
                "first_name": "瓦尔特",
                "last_name": "Cox",
                "position": "Technical Author333",
                "office": "San Francisco",
                "start_date": "12th Jan 09",
                "salary": 150083003.014,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            },
            {
                "DT_RowId": "row_20",
                "DT_RowData": {
                    "pkey": 17
                },
                "first_name": "预科",
                "last_name": "Cox",
                "position": "Technical Author333",
                "office": "San Francisco",
                "start_date": "12th Jan 09",
                "salary": 150083003.014,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            },
            {
                "DT_RowId": "row_21",
                "DT_RowData": {
                    "pkey": 17
                },
                "first_name": "规划局看过",
                "last_name": "Cox",
                "position": "Technical Author333",
                "office": "San Francisco",
                "start_date": "12th Jan 09",
                "salary": 150083003.014,
                "node1": "11",
                "node2": "22",
                "node3": "33",
                "node4": "44"
            }
        ]
    };

    $(function () {
        /*
         *  $.mockjax 此方法仅限于demo演示模拟数据使用
         */
        $.mockjax({
            url: "/dt/api",
            dataType: "json",
            response: function (settings) {
                dt_data_['draw'] = settings.data['draw'];
                $.each(dt_data_['data'], function (i, n) {
//					n['first_name'] = 'name' + COM_TOOLS.get_random_fun(3);
//					n['DT_RowId'] = 'row_' + COM_TOOLS.get_random_fun(3);
                });
                this.responseText = dt_data_;
            }
        });
    });

    $(document).ready(function () {
        /*自定义滚动条*/
        $('#name_box .name-box-cont').mCustomScrollbar({theme: "dark-3"});
        $("#empty").click(function () {
            if (cum_Modalindex_ > 0) {
                var b_ = parent.layer.getChildFrame('body', cum_Modalindex_);//获取上一个弹窗对象
                if (cum_ModalValobj) {
                    parent.$('#' + cum_ModalValobj, b_).val('');
                    parent.$('#' + cum_ModalValobj + '_hide', b_).val('');
                }
                cumParentCallValue();
            }
        });
        var searchParemOBj_ = {};
        var DT_ = COM_TOOLS.DT_init('example1', [{
                "data": null,
                "className": "text-center",
                "width": "30px",
                render: function (data, type, row, meta) { /*显示行号*/
                    return 1 + meta.row;
                }
            }, {
                "data": null,
                "className": "select-checkbox",
                "defaultContent": ''
            }, {
                "data": "first_name"
            }, {
                "data": "last_name"
            }, {
                "data": "start_date"
            }],
            '/dt/api',
            'get',
            searchParemOBj_,
            {
                jsDrawCallback: function () {
                    if ($('#name_box .name-box-cont span').length > 0) {
//                        $( selector ).dataTable().api();
                        console.log('===',this);
                        var api = this;
                        var row_ = api.rows({page: 'current'}).data();
                        api.rows({page: 'current'}).every(function(){
                            var t_ = this;
                            $('#name_box .name-box-cont span').each(function (j) {
                                var id_ = $(this).data('itemid');
                                if (id_ == t_.data().DT_RowId) {
                                    t_.select();
                                }
                            })
                        })
                       /* $.each(row_, function (i, n) {
                            $('#name_box .name-box-cont span').each(function (j) {
                                var id_ = $(this).data('itemid');
                                if (id_ == n.DT_RowId) {
                                    $('tr[id=' + id_ + ']').addClass('selected').trigger('select.dt')
                                }
                            })
                        })*/
                    }
                }
            })
        var table = DT_.table;
        $('#searchBtn').click(function () {
            $('#example1 tbody').show();
            table.draw();
        });
        /*表格选中后执行操作*/
        table.on('select', function (e, dt, type, indexes) {
            if (type === 'row') {
                var t_ = table.rows(indexes).nodes().to$(); //获取当前行，并转化为jQuery对象
                var id_ = t_.attr('id');
                var text_ = t_.find('td:eq(2)').text();
                var box_ =  $('#name_box .name-box-cont #mCSB_1_container');
                if( !box_.find('[data-itemid=' + id_ + ']').length>0){
                    $('#name_box .name-box-cont #mCSB_1_container').append('<span class="tips-name" data-itemid="' + id_ + '">' + text_ + ' <i class="glyphicon glyphicon-remove-circle"></i></span>');
                }
            }
        }).on('deselect', function (e, dt, type, indexes) {
            if (type === 'row') {
                var t_ = table.rows(indexes).nodes().to$();
                var id_ = t_.attr('id');
                $('#name_box span[data-itemid=' + id_ + ']').remove();
            }
        });
    });
    $('#name_box .name-box-cont').on('click', 'span.tips-name>i', function () {
        var api = $('#example1').dataTable().api();
        var row_ = api.rows({page: 'current'}).data();
        var id_ = $(this).parent().data('itemid');
        $.each(row_, function (i, n) {
            if (id_ == n.DT_RowId) {
                $('#example1 tr[id=' + id_ + ']').removeClass('selected')
            }
        });
        $(this).parent().remove();
    });
    $('#remove_all').click(function () {
        var api = $('#example1').dataTable().api();
        api.rows({page: 'current'}).deselect();
//        $('#example1 tr').removeClass('selected');
        $('#name_box .name-box-cont span.tips-name').remove();
    });
    $('#save_all').click(function () {
        var span_ = $('#name_box .name-box-cont span.tips-name');
        var id_list = [], text_list = [];
        if (span_.length > 0) {
            span_.each(function (i) {
                id_list.push($(this).data('itemid'));
                text_list.push($(this).text());
            });
            cumParentCallValue(function () {
                console.log('##' + cum_Modalindex_);
                if (cum_Modalindex_ > 0) {
                    alert(cum_Modalindex_ + "====");
                    var b_ = parent.layer.getChildFrame('body', cum_Modalindex_);//获取上一个弹窗对象
                    if (cum_ModalValobj) {
                        alert(cum_ModalValobj);
                        parent.$('#' + cum_ModalValobj, b_).val(text_list.join(','));
                    }
                }
            });
            console.log(id_list.join(','));
            console.log(text_list.join(','));
        }
    })


</script>
</body>
</html>
