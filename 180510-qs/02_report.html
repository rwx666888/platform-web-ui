<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <title>排名-集团销售利润</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link href="../css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .row {
            margin: 0 -10px
        }

        .col-sm-4,
        .col-sm-6,
        .col-sm-12 {
            padding: 0 10px;
        }

        .tab-content {
            padding: 10px;
            border: 1px solid #ddd;
            border-top: none;
            border-bottom-left-radius: 3px;
            border-bottom-right-radius: 3px;
        }

        .tab-content .panel {
            margin-bottom: 0;
        }

        .table {
            font-size: 12px;
        }

        .dataTables_wrapper {
            padding-bottom: 0;
        }

        .panel-heading,
        .panel-body {
            padding: 10px;
        }

        .cus-group-area {
            margin-top: 20px;
        }

        .cus-echarts {
            width: 100%;
            height: 350px;
            margin-bottom: 20px;
            border-bottom: 2px solid #337ab7;
            padding-bottom: 10px;
        }

        .cus-echarts:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="cus-group-area">
            <div class="row">
                <div class="col-sm-12">
                    <!-- <h3>排名-集团销售利润</h3> -->
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="panel panel-success">
                        <div class="panel-heading">利润排名（累计）</div>
                        <div class="panel-body">
                            <table id="dt_report_01" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%">
                                <thead>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">利润排名（累计）</div>
                        <div class="panel-body">
                            <table id="dt_report_02" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%">
                                <thead>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../js/jquery-2.1.1.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../js/plugins/datatables/datatables.min.js"></script>
    <script src="../js/plugins/jquery-number/jquery.number.min.js" type="text/javascript"></script>
    <script src="../i18n/zh-CN.js" type="text/javascript"></script>
    <script src="../js/subindex.js" type="text/javascript"></script>
    <script src="../js/jquery.mockjax.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        var s_data = {
            "draw": 1,
            "recordsTotal": 15,
            "recordsFiltered": 15,
            "data": [{
                "id": "0",
                "areayname": "直辖",
                "subareayname": "",
                "cityname": "青岛",
                "centername": "第一浴场中心",
                "old_order": "1",
                "new_order": "3",
                "number": 10759802.15792,
                "numberrate": 0.16,
                "t_number": 9525,
                "t_rate": 0.15,
                "n_increaserate": 0.16,
                "new_totulerate": 0.234,
                "old_totulerate": 0.123,
                "change": -0.001,
                "type": 1
            }, {
                "id": "0",
                "areayname": "直辖",
                "subareayname": "",
                "cityname": "北京",
                "centername": "中关村中心",
                "old_order": "1",
                "new_order": "3",
                "number": 8893215.82375,
                "numberrate": 0.16,
                "t_number": 9525,
                "t_rate": 0.15,
                "n_increaserate": 0.16,
                "new_totulerate": 0.234,
                "old_totulerate": 0.123,
                "change": -0.001,
                "type": 1
            }, {
                "id": "0",
                "areayname": "",
                "subareayname": "闽浙赣区域",
                "cityname": "杭州",
                "centername": "五岭广场中心",
                "old_order": "2",
                "new_order": "2",
                "number": 7997619.05521,
                "numberrate": 0.16,
                "t_number": 90525,
                "t_rate": 0.17,
                "n_increaserate": -0.16,
                "new_totulerate": 0.345,
                "old_totulerate": 0.387,
                "change": -0.10,
                "type": 2
            }, {
                "id": "0",
                "areayname": "区域合并",
                "subareayname": "",
                "cityname": "广州",
                "centername": "天河中心",
                "old_order": "1",
                "new_order": "2",
                "number": -1655075.06908,
                "numberrate": 0.16,
                "t_number": 6525,
                "t_rate": 0.10,
                "n_increaserate": 0.06,
                "new_totulerate": 0.234,
                "old_totulerate": 0.123,
                "change": -0.01,
                "type": 3
            }, {
                "id": "0",
                "areayname": "",
                "subareayname": "达内集团总部",
                "cityname": "南京",
                "centername": "夫子庙中心",
                "old_order": "3",
                "new_order": "2",
                "number": 9652694.12429,
                "numberrate": 0.16,
                "t_number": 3372,
                "t_rate": 0.05,
                "n_increaserate": 0.50,
                "new_totulerate": 0.234,
                "old_totulerate": 0.123,
                "change": -0.01,
                "type": 2
            }, {
                "id": "0",
                "areayname": "1",
                "subareayname": "",
                "cityname": "长沙",
                "centername": "臭豆腐中心",
                "old_order": "3",
                "new_order": "1",
                "number": 6956026.09665,
                "numberrate": 0.16,
                "t_number": 1565,
                "t_rate": 0.05,
                "n_increaserate": -0.06,
                "new_totulerate": 0.234,
                "old_totulerate": 0.123,
                "change": -0.01,
                "type": 1
            }]
        };
        $.mockjax({
            url: "/dt/api",
            dataType: "json",
            response: function (settings) {
                s_data['draw'] = settings.data['draw'];
                this.responseText = s_data;
            }
        });
    </script>
    <script type="text/javascript">
        $(function () {
            var PRO_TOOLS = {
                //减    
                floatSub: function (arg1, arg2) {
                    if (arg1 != null && arg2 != null) {
                        var r1, r2, m, n;
                        try { r1 = arg1.toString().split(".")[1].length; } catch (e) { r1 = 0; }
                        try { r2 = arg2.toString().split(".")[1].length; } catch (e) { r2 = 0; }
                        m = Math.pow(10, Math.max(r1, r2));
                        //动态控制精度长度    
                        n = (r1 >= r2) ? r1 : r2;
                        return ((arg1 * m - arg2 * m) / m).toFixed(n);
                    } else {
                        return '-';
                    }
                },
                // 除法
                floatDiv: function (arg1, arg2) {
                    if (arg1 != null && arg2 != null) {
                        var t1 = 0,
                            t2 = 0,
                            r1, r2;
                        try { t1 = arg1.toString().split(".")[1].length; } catch (e) { }
                        try { t2 = arg2.toString().split(".")[1].length; } catch (e) { }
                        r1 = Number(arg1.toString().replace(".", ""));
                        r2 = Number(arg2.toString().replace(".", ""));
                        return (r1 / r2) * Math.pow(10, t2 - t1);
                    } else {
                        return '-';
                    }
                },
                // 乘    
                floatMul: function (arg1, arg2) {
                    if (arg1 != null && arg2 != null) {
                        var m = 0,
                            s1 = arg1.toString(),
                            s2 = arg2.toString();
                        try { m += s1.split(".")[1].length; } catch (e) { }
                        try { m += s2.split(".")[1].length; } catch (e) { }
                        return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m);
                    } else {
                        return '-';
                    }
                },
                // type 显示类型 0-默认，整数， 1-百分比
                changeNum: function (row, name1, name2, type, dec) {
                    var res_ = '';
                    if (row.type != 2) {
                        res_ = this.floatSub(row[name1], row[name2]);
                        if (res_ > 0) {
                            res_ = (type ? '<span class="text-info">+' + (this.dataProcess(this.floatMul(res_, 100), dec || 0) + '%') + '</span>' : '<span class="text-info">+' + this.cusNumber(res_, dec) + '</span>');
                        } else if (res_ < 0) {
                            res_ = (type ? '<span class="text-danger">-' + (this.dataProcess(this.floatMul(Math.abs(res_), 100), dec || 0) + '%') + '</span>' : '<span class="text-danger">-' + this.cusNumber(Math.abs(res_), dec) + '</span>');
                        } else {
                            res_ = '-';
                        }
                    }
                    return res_;
                },
                dataFilter: function (data, row) {
                    var res_ = data;
                    if (row.type == 2) {
                        res_ = '';
                    }
                    return res_;
                },
                dataProcess: function (s_data, dec) {
                    var num = Number(s_data);
                    if (num) {
                        if (Math.abs(num) > 1) {
                            num = dec >= 0 ? num.toFixed(dec) : num;
                        } else {
                            num = num;
                        }
                    } else {
                        num = s_data;
                    }
                    return (num != null ? num : '-');
                },
                cusNumber: function (s_data, dec) {
                    if (s_data != null) {
                        s_data = ($.number && $.number(s_data, dec || 0)) || s_data;
                    } else {
                        s_data = '-';
                    }
                    return s_data;
                },
                cusFloor: function(data, floor_num){
                    return this.cusNumber(this.floatDiv(data, floor_num))
                },
                sp_dataShow: function (ele, s_arr) {
                    var $ele = $('#' + ele).closest('.js-data-show');
                    var t_data = $.grep(s_arr, function (n, i) {
                        return n.type == 3;
                    })[0];
                    if (!$.isEmptyObject(t_data)) {
                        $ele.find('.js-money').text($.number(t_data.number));
                        $ele.find('.js-complete-rate').text(PRO_TOOLS.floatMul(t_data.t_rate, 100) + '%');
                        $ele.find('.js-increase-rate').text(PRO_TOOLS.floatMul(t_data.n_increaserate, 100) + '%');
                    }
                }
            };

            /**
             * [cusDTinit description]
             * @param  {[type]} ele    [表格对象]
             * @param  {[type]} cols   [表格列对象]
             * @param  {[type]} a_url  [接口]
             * @param  {[type]} a_data [请求参数]
             * @param  {[type]} opt    [表格配置项]
             */
            function cusDTinit(ele, cols, a_url, a_data, opt) {
                var searchParemOBj_ = (a_data || {}),
                    baseOpt = $.extend(true, {
                        account_type: 1,
                        other: {
                            select: false,
                            paging: false,
                            info: false
                        }
                    }, (opt || {}));

                var base_cols = [{
                    "title": "排名",
                    "className": "text-center",
                    "data": "new_order",
                    "render": function (data, type, row, meta) {
                        return PRO_TOOLS.dataFilter(data, row);
                    }
                }, {
                    "title": "销售利润(万)",
                    "className": "text-right",
                    "data": "number",
                    "render": function (data, type, row, meta) {
                        // return $.number(data);
                        // return PRO_TOOLS.cusNumber(data);
                        return PRO_TOOLS.cusFloor(data, 10000);
                    }
                }, {
                    "title": "利润率",
                    "className": "text-center",
                    "data": "numberrate",
                    "render": function (data, type, row, meta) {
                        return (PRO_TOOLS.floatMul(data, 100) + '%');
                    }
                }, {
                    "title": "完成率",
                    "className": "text-right",
                    "data": "t_number",
                    "render": function (data, type, row, meta) {
                        return $.number(data);
                    }
                }, {
                    "title": "增长率",
                    "className": "text-center",
                    "data": "n_increaserate",
                    "render": function (data, type, row, meta) {
                        return (PRO_TOOLS.floatMul(data, 100) + '%');
                    }
                }];
                // 权限处理
                //var account_type = 1;
                if (baseOpt.account_type == 1) {
                    base_cols.unshift({
                        "title": "区域",
                        "data": "areayname",
                        "render": function (data, type, row, meta) {
                            return PRO_TOOLS.dataFilter(data, row);
                        }
                    }, {
                            "title": "分区",
                            "data": "subareayname"
                        });
                } else if (baseOpt.account_type == 2) {
                    base_cols.unshift({
                        "title": "城市",
                        "data": "cityname"
                    });
                } else if (baseOpt.account_type == 3) {
                    base_cols.unshift({
                        "title": "中心",
                        "data": "centername"
                    });
                }
                // 用户配置的cols
                var dy_cols = $.extend(true, base_cols, cols);

                return COM_TOOLS.DT_init(ele, dy_cols, a_url, 'get', searchParemOBj_, baseOpt);
            }

            // 初始化表格
            cusDTinit('dt_report_01', [], '/dt/api', { id: 11 }, {
                other: {
                    createdRow: function (row, data, dataIndex) {
                        if (data.type == 3) {
                            $(row).addClass('bg-danger');
                        }
                    }
                }
            });
            cusDTinit('dt_report_02', [], '/dt/api', { id: 11 }, {
                other: {
                    createdRow: function (row, data, dataIndex) {
                        if (data.type == 3) {
                            $(row).addClass('bg-danger');
                        }
                    }
                }
            });
        });
    </script>
</body>

</html>